function openUserMenu() {
	document.getElementById("userMenu").classList.add("opm-show");
}

$(document).mouseup(function (e){
	var dropdowns = document.getElementsByClassName("opm-dropmenu");
	if (dropdowns[0].classList.contains('opm-show'))
	{
		dropdowns[0].classList.remove('opm-show');
	}
});

function opmSidebarChangeType() {
	var sidebar = document.getElementsByClassName("opm-sidebar");
	if(sidebar[0].classList.contains('opm-sidebar-small'))
	{
		sidebar[0].classList.remove('opm-sidebar-small');
		var sidebar_item_label = document.getElementsByClassName('opm-sidebar-item-label');
		for (var i=0; i < sidebar_item_label.length; i++) {
			sidebar_item_label[i].style.display = 'block';
			sidebar_item_label[i].style.setProperty("display", "block", "important")
		}
		$.ajax({
			type:"GET",
			url:"index.php",
			data:{opermon:"updatesidebartype",sidebartype:1}
		});
	}
	else
	{
		sidebar[0].classList.add('opm-sidebar-small');
		var sidebar_item_label = document.getElementsByClassName('opm-sidebar-item-label');
		for (var i=0; i < sidebar_item_label.length; i++) {
			sidebar_item_label[i].style.display = 'none';
		}
		$.ajax({
			type:"GET",
			url:"index.php",
			data:{opermon:"updatesidebartype",sidebartype:0}
		});
	}
}

function showDashboard() {
	showDashboardPannel();
	var blades = document.getElementsByClassName("opm-portal-blades");
	for (var i=0; i < blades.length; i++) {
		blades[0].classList.add('opm-hidden');
	}
}

function hideAllPannels() {
	var blades = document.getElementsByClassName("opm-portal-js");
	for (var i=0; i < blades.length; i++) {
		blades[i].classList.add('opm-hidden');
	}
}

function hideSettingsPannel() {
	var pannels = document.getElementsByClassName("opm-settingspane");
	for (var i=0; i < pannels.length; i++) {
		pannels[0].classList.add('opm-hidden');
	}
	GetDataFromItem("opm-red-message", "opermon.settings.error").classList.add("opm-hidden");
	SetDataToItem("opm-red-message" ,"opermon.settings.error", "");
}

function showSettingsPannel() {
	var pannels = document.getElementsByClassName("opm-settingspane");
	for (var i=0; i < pannels.length; i++) {
		pannels[0].classList.remove('opm-hidden');
	}
}

function hideDashboardPannel() {
	var dashboard = document.getElementsByClassName("opm-dashboard");
	for (var i=0; i < dashboard.length; i++) {
		dashboard[0].classList.add('opm-hidden');
	}
}

function showDashboardPannel() {
	var dashboard = document.getElementsByClassName("opm-dashboard");
	for (var i=0; i < dashboard.length; i++) {
		dashboard[0].classList.remove('opm-hidden');
	}
}

function applyUserSettings(){
	$.ajax({
		type:"GET",
		url:"index.php",
		data:{opermon:"savesettings",newpassword:GetDataFromItem("opm-input-text", "opermon.settings.password.new").value,confirmpassword:GetDataFromItem("opm-input-text", "opermon.settings.password.confirm").value,domain:GetDataFromItem("opm-input-text", "opermon.settings.domain").value},
		success:function(data){
			data = jQuery.trim(data);
			if(data == "-2")
			{
				GetDataFromItem("opm-red-message", "opermon.settings.error").classList.add("opm-hidden");
				SetDataToItem("opm-red-message" ,"opermon.settings.error", "");
			}
			else if(data == "-1")
			{
				GetDataFromItem("opm-red-message", "opermon.settings.error").classList.remove("opm-hidden");
				SetDataToItem("opm-red-message" ,"opermon.settings.error", "Passwords are not same!");
			}
			else if(data == "-3")
			{
				GetDataFromItem("opm-red-message", "opermon.settings.error").classList.remove("opm-hidden");
				SetDataToItem("opm-red-message" ,"opermon.settings.error", "Password must not be empty or less than 4 digits!");
			}
			else if(data == "0")
			{
				GetDataFromItem("opm-red-message", "opermon.settings.error").classList.remove("opm-hidden");
				SetDataToItem("opm-red-message" ,"opermon.settings.error", "Settings saved!");
				GetDataFromItem("opm-input-text", "opermon.settings.password.new").value = "";
				GetDataFromItem("opm-input-text", "opermon.settings.password.confirm").value = "";
			}
		}
	});
}

function BladeLeftTableToggle(hide_blade_name, hide)
{
	var table_left = document.getElementsByClassName("opm-grid-hide");
	for (var i = 0; i < table_left.length; i++) 
	{
		if (table_left[i].getAttribute('data-info') == hide_blade_name)
		{
			if(hide == false)
			{
				table_left[i].classList.remove('opm-hidden');
			}
			else
			{
				table_left[i].classList.add('opm-hidden');
			}
		}
	}
}

function SetDataToItem(class_name, data_info_value, data)
{
	var item = document.getElementsByClassName(class_name);
	for (var i = 0; i < item.length; i++) 
	{
		if (item[i].getAttribute('data-info') == data_info_value)
		{
			item[i].innerHTML = data;
		}
	}
}

function GetDataFromItem(class_name, data_info_value)
{
	var item_html;
	var item = document.getElementsByClassName(class_name);
	for (var i = 0; i < item.length; i++) 
	{
		if (item[i].getAttribute('data-info') == data_info_value)
		{
			item_html = item[i];
		}
	}
	return item_html;
}

function Startup()
{
	setInterval(_SetUserStatus, 20000);
	setInterval(_GetUsersStatuses, 20000);
	_GetUsersStatuses();
	_GetMessages();
}

function _SetUserStatus()
{
	$.ajax({
		type:"GET",
		url:"index.php",
		data:{opermon:"updateuserstatus"}
	});
}

function _GetUsersStatuses()
{
	$.ajax({
		type:"GET",
		url:"index.php",
		data:{opermon:"getusersstatuses"},
		success:function(data){
			GetDataFromItem("opm-dashboard-users-content", "dashboard.users.content").innerHTML = data;
		}
	});
}

function _GetMessages()
{
	$.ajax({
		type:"GET",
		url:"index.php",
		data:{opermon:"getmessages"},
		success:function(data){
			GetDataFromItem("opm-dashboard-messages", "dashboard.messages").innerHTML = data;
		}
	});
}